<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="使用方法：docker export CONTAINER 例子： $ sudo docker export red_panda &amp;gt; latest.tardocker export &amp;lt;CONTAINER ID&amp;gt; &amp;gt; /home/export.tar cat /home/export.tar | sudo docker import - busybox-1-export:lat">
<meta name="keywords" content="云计算 大数据 AI 安全">
<meta property="og:type" content="article">
<meta property="og:title" content="docker">
<meta property="og:url" content="http://tianjinchen.com/2015/06/20/docker/index.html">
<meta property="og:site_name" content="一君的博客">
<meta property="og:description" content="使用方法：docker export CONTAINER 例子： $ sudo docker export red_panda &amp;gt; latest.tardocker export &amp;lt;CONTAINER ID&amp;gt; &amp;gt; /home/export.tar cat /home/export.tar | sudo docker import - busybox-1-export:lat">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-07-11T09:10:22.577Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="docker">
<meta name="twitter:description" content="使用方法：docker export CONTAINER 例子： $ sudo docker export red_panda &amp;gt; latest.tardocker export &amp;lt;CONTAINER ID&amp;gt; &amp;gt; /home/export.tar cat /home/export.tar | sudo docker import - busybox-1-export:lat">





  
  
  <link rel="canonical" href="http://tianjinchen.com/2015/06/20/docker/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>docker | 一君的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">一君的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Navigationsleiste an/ausschalten">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Startseite</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Schlagwörter</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Kategorien</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-读书">

    
    
      
    

    

    <a href="/books" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i> <br>读书</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-电影">

    
    
      
    

    

    <a href="/movies" rel="section"><i class="menu-item-icon fa fa-fw fa-film"></i> <br>电影</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar-check-o"></i> <br>Archiv</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://tianjinchen.com/2015/06/20/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sam Tian">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一君的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">docker

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2015-06-20 17:20:00" itemprop="dateCreated datePublished" datetime="2015-06-20T17:20:00+08:00">2015-06-20</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Bearbeitet am</span>
                
                <time title="Geändert am: 2019-07-11 17:10:22" itemprop="dateModified" datetime="2019-07-11T17:10:22+08:00">2019-07-11</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          <br>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">Symbole im Artikel gezählt: </span>
              
              <span title="Symbole im Artikel gezählt">8.3k</span>
            </span>
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">Lesezeit &asymp;</span>
              
              <span title="Lesezeit">8 minuten.</span>
            </span>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>使用方法：docker export CONTAINER</p>
<p>例子：</p>
<p>$ sudo docker export red_panda &gt; latest.tar<br><br>docker export &lt;CONTAINER ID&gt; &gt; /home/export.tar<br></p>
<p>cat /home/export.tar | sudo docker import - busybox-1-export:latest<br><br>使用说明：<br></p>
<p>把容器系统文件打包并导出来，方便分发给其他场景使用。<br></p>
<a id="more"></a>
<p>import / save / load<br><br> docker load &lt; /home/save.tar<br><br>使用方法：<br></p>
<p>docker import URL|- [REPOSITORY[:TAG]]<br><br>docker save IMAGE<br><br>docker load<br><br>$ docker save dgageot/java8 &gt; image.tar<br><br>$ docker load dgageot/java8 &lt; image.tar<br><br>使用说明：<br><br><br><br>这一组命令是系统运维里非常关键的命令。加载(两种方法: import, load)，导出(一种方法: save)容器系统文件。<br><br><br></p>
<pre><code class="&lt;br/&gt;">&lt;br/&gt;
镜像导入/导出构建的镜像，作为一种状态存在，支持很方便的导入导出。导出：&lt;br/&gt;
&lt;br/&gt;
docker save IMAGENAME | bzip2 -9 -c&amp;gt;img.tar.bz2&lt;br/&gt;
&lt;br/&gt;
导入镜像：&lt;br/&gt;
&lt;br/&gt;
bzip2 -d -c &amp;lt;img.tar.bz2 | docker load&lt;br/&gt;
&lt;br/&gt;
&lt;/p&gt;
&lt;p&gt;
  $ docker run -d -p 5000:5000 \
        --restart=always --name registry registry:2
  &lt;/p&gt;
 &lt;p&gt;  $ docker run -d -p 5000:5000 \
    -e REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY=/var/lib/registry \
    -v /myregistrydata:/var/lib/registry \
    --restart=always --name registry registry:2

    &lt;/p&gt;
    &lt;p&gt;
    # Stop your registry
docker stop registry &amp;&amp; docker rm registry

# Start your registry with TLS enabled
docker run -d -p 5000:5000 \
    -v `pwd`/certs:/certs \
    -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \
    -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \
    --restart=always --name registry \
    registry:2&lt;/p&gt;
    &lt;p&gt;
chcon -Rt svirt_sandbox_file_t /home/docker/leakchenk/dubbo
docker run  -v /home/docker/leakchenk/dubbo:/dubbo -p 8888:8888 --name leakcheck leakcheck /dubbo/bin/server.sh start


systemctl stop firewalld.service
systemctl disable firewalld.service
systemctl enable firewalld.service



 docker run --rm -it -v /home/checkleak/dubbo/data/20150626190241142:/code python:2.7.10 python /code/ssltest.py 192.168.72.5  | tail

 &lt;/p&gt;&lt;p&gt;
 &lt;p&gt;
 Usage: docker tag [OPTIONS] IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]
  &lt;/p&gt;&lt;p&gt;
   docker build -t vieux/apache:2.0 .
 &lt;/p&gt;&lt;p&gt;
 docker commit containeris repos:tag
 &lt;/p&gt;
 #############################jenkins#######################&lt;br/&gt;
 chown 1000:1000 /home/docker/app/jenkins
 docker run  --rm -it --name myjenkins2 -p 8090:8080 -v /home/docker/app/jenkins:/var/jenkins_home jenkins&lt;br/&gt;

 docker run  -d  --rm --restart always --name myjenkins -p 8080:8080 -v /home/docker/app/jenkins:/var/jenkins_home jenkins&lt;br/&gt;

 docker pull evarga/jenkins-slave need jdk ssh user&lt;br/&gt;

docker run -d -p 8080:8080 -v $PWD/jenkins:/var/lib/jenkins -t jenkins-image&lt;br/&gt;
docker run -p 8080:8080 -v /your/home:/var/jenkins_home jenkins&lt;br/&gt;

 docker run \&lt;br/&gt;&lt;br/&gt;
-e JENKINS_USERNAME=jenkins \&lt;br/&gt;
-e JENKINS_PASSWORD=jenkins \&lt;br/&gt;
-e JENKINS_MASTER=http://jenkins:8080 \&lt;br/&gt;
-e RUBYGEMS_API_KEY=xxxxx \&lt;br/&gt;&lt;br/&gt;
-e GEMINABOX=https://xxx:yyy@gems.acme.com \&lt;br/&gt;
-e PUPPETFORGE_USERNAME=john \&lt;br/&gt;
-e PUPPETFORGE_PASSWORD=doe \&lt;br/&gt;
maestrodev/build-agent&lt;/p&gt;
&lt;p&gt;{{ page.date | date_to_string }}&lt;/p&gt;export


http://elrepo.org/linux/kernel/el7/x86_64/


You could upgrade the kernel via elrepo.

rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm (external link)
yum install --enablerepo=elrepo-kernel kernel-ml

You can also install the updated firmware and headers

yum install --enablerepo=elrepo-kernel kernel-ml-{firmware,headers,devel}

You&apos;ll probably need to remove the kernel-firmware first:

yum remove kernel-{firmware,headers,devel}

Optional, to remove kernel 4.3.3 do:

# yum remove kernel-ml

rpm -q kernel 
rpm -e kernel-2.6.32-279.14.1.el6.i686


docker product config
loop-lvm mode
Configure direct-lvm mode for production
 configure Docker with systemd

   参见： https://docs.docker.com/engine/admin/systemd/

   /etc/systemd/system/docker.service.d/docker.conf
[Service]
ExecStart=
ExecStart=/usr/bin/docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --mtu=1450 --bip=10.1.21.1/24  --insecure-registry tcr:5000


DOCKER_OPTS=&quot;--storage-driver=devicemapper --storage-opt dm.basesize=50G --storage-opt dm.datadev=/dev/sde1 --storage-opt dm.metadatadev=/dev/sdf1&quot;
sudo docker daemon --storage-driver=devicemapper --storage-opt dm.basesize=30G --storage-opt dm.datadev=/dev/vg-docker/data --storage-opt dm.metadatadev=/dev/vg-docker/metadata &amp;
注解：

    basesize 表示镜像和容器的空间大小，不同容器如果使用相同镜像，不会增加大小。容器内的修改应用COW技术，修改后的内容不计算此空间中，默认10G，建议basesize设为datadev设备分区大小的1/3
    datadev 存放镜像和容器，要求必须是ext4或xfs文件系统，默认ext4，如果设为xfs，使用dm.fs指定
    metadatadev 用于存放元数据，对空间要求不大，可建立一个10G的分区。建议和datadev使用不同设备，如果条件许可，使用SSD，使用时需要将分区前4k清0。 dd if=/dev/zero of=$metadata_dev bs=4096 count=1

sudo systemctl daemon-reload


[Service]
ExecStart=
ExecStart=/usr/bin/docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --mtu=1450 --bip=10.1.21.1/24 --storage-driver=devicemapper --storage-opt dm.basesize=30G --storage-opt dm.datadev=/dev/vg-docker/data --storage-opt dm.metadatadev=/dev/vg-docker/metadata --insecure-registry tcr:5000


Log in to the Docker host you want to configure and stop the Docker daemon.

If it exists, delete your existing image store by removing the /var/lib/docker directory.

$ sudo rm -rf /var/lib/docker

Create an LVM physical volume (PV) on your spare block device using the pvcreate command.

$ sudo pvcreate /dev/xvdf
Physical volume `/dev/xvdf` successfully created

The device identifier may be different on your system. Remember to substitute your value in the command above.

Create a new volume group (VG) called vg-docker using the PV created in the previous step.

$ sudo vgcreate vg-docker /dev/xvdf
Volume group `vg-docker` successfully created

Create a new 90GB logical volume (LV) called data from space in the vg-docker volume group.

$ sudo lvcreate -L 90G -n data vg-docker
Logical volume `data` created.

The command creates an LVM logical volume called data and an associated block device file at /dev/vg-docker/data. In a later step, you instruct the devicemapper storage driver to use this block device to store image and container data.


If you receive a signature detection warning, make sure you are working on the correct devices before continuing. Signature warnings indicate that the device you’re working on is currently in use by LVM or has been used by LVM in the past.

Create a new logical volume (LV) called metadata from space in the vg-docker volume group.

$ sudo lvcreate -L 4G -n metadata vg-docker
Logical volume `metadata` created.

This creates an LVM logical volume called metadata and an associated block device file at /dev/vg-docker/metadata. In the next step you instruct the devicemapper storage driver to use this block device to store image and container metadata.

Start the Docker daemon with the devicemapper storage driver and the --storage-opt flags.

The data and metadata devices that you pass to the --storage-opt options were created in the previous steps.

$ sudo docker daemon --storage-driver=devicemapper --storage-opt dm.datadev=/dev/vg-docker/data --storage-opt dm.metadatadev=/dev/vg-docker/metadata &amp;
  [1] 2163
  [root@ip-10-0-0-75 centos]# INFO[0000] Listening for HTTP on unix (/var/run/docker.sock)
  INFO[0027] Option DefaultDriver: bridge
  INFO[0027] Option DefaultNetwork: bridge
  &lt;output truncated&gt;
  INFO[0027] Daemon has completed initialization
  INFO[0027] Docker daemon commit=0a8c2e3 execdriver=native-0.2 graphdriver=devicemapper version=1.8.2

  It is also possible to set the --storage-driver and --storage-opt flags in the Docker config file and start the daemon normally using the service or systemd commands.

Use the docker info command to verify that the daemon is using data and metadata devices you created.

$ sudo docker info
INFO[0180] GET /v1.20/info
Containers: 0
Images: 0
Storage Driver: devicemapper
 Pool Name: docker-202:1-1032-pool
 Pool Blocksize: 65.54 kB
 Backing Filesystem: xfs
 Data file: /dev/vg-docker/data
 Metadata file: /dev/vg-docker/metadata
[...]

The output of the command above shows the storage driver as devicemapper. The last two lines also confirm that the correct devices are being used for the Data file and the Metadata file.


</code></pre>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/09/16/hello-world/" rel="next" title="Hello World">
                <i class="fa fa-chevron-left"></i> Hello World
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/04/12/linuxshell/" rel="prev" title="shell">
                shell <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Sam Tian</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">Artikel</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/tianshangjun" title="GitHub &rarr; https://github.com/tianshangjun" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sam Tian</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Insgesamt gezählte Symbole">48k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="Insgesamte Lesezeit">43 minuten.</span>
  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>




  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  


  <script src="/js/next-boot.js?v=7.2.0"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
